<% def render_errors_with_remotipart %>
  <% if remotipart_submitted? %>
    $('.errors').html('<%= j "#{render 'common/errors', resource: @answer}" %>');
  <% else %>
    $('.errors').html('<%= j render 'common/errors', resource: @answer %>');
  <% end %>
<% end %>

<% if @answer.errors.present? %>
  <% render_errors_with_remotipart %>
  $('.new_answer .form-group').addClass('field_with_errors');
<% else %>
  $('.errors').empty();
  $('.new_answer .form-group').removeClass('field_with_errors');
  <% if remotipart_submitted? %>
    $('.answers').append('<%= j "#{render @answer}" %>');
  <% else %>
    $('.answers').append('<%= j render @answer %>');
  <% end %>
  $('.new_answer #answer_body').val('');
  $('.nested-fields').remove();
<% end %>

$('.flash').html('<%= bootstrap_flash %>');
<% flash.discard %>
